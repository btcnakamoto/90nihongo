# 90天日语学习平台 - 批量导入功能

## 🚀 功能概述

批量导入功能是90天日语学习平台内容管理系统的核心特性之一，支持高效批量导入课程、学习材料、词汇和练习题等教学资源。

### ✨ 主要特性

- **多格式支持**：CSV、Excel、JSON三种文件格式
- **智能验证**：实时数据格式验证和错误提示
- **预览确认**：导入前可预览数据内容
- **进度追踪**：实时显示导入进度和状态
- **错误处理**：详细的错误报告和修复建议
- **模板下载**：提供标准格式模板文件
- **批量操作**：支持批量删除和数据导出

## 📋 支持的内容类型

### 1. 课程批量导入
**必填字段：**
- `title`：课程标题
- `description`：课程描述  
- `day_number`：课程天数 (1-90)
- `difficulty`：难度级别 (beginner/intermediate/advanced)

**可选字段：**
- `tags`：标签 (逗号分隔)
- `is_active`：是否启用 (true/false)

**示例CSV模板：**
```csv
title,description,day_number,difficulty,tags,is_active
第1天：基础问候,学习基础的日语问候语,1,beginner,"问候,基础",true
第2天：数字表达,学习日语数字1-10,2,beginner,"数字,基础",true
```

### 2. 学习材料批量导入
**必填字段：**
- `title`：材料标题
- `type`：材料类型 (video/audio/text/quiz)
- `course_day`：所属课程天数
- `content`：材料内容

**可选字段：**
- `media_url`：媒体文件URL
- `duration_minutes`：时长（分钟）

**示例CSV模板：**
```csv
title,type,course_day,content,media_url,duration_minutes
问候语视频,video,1,基础问候语教学视频,https://example.com/video1.mp4,10
数字发音音频,audio,2,数字1-10发音练习,https://example.com/audio1.mp3,5
```

### 3. 词汇批量导入
**必填字段：**
- `word`：日语词汇
- `reading`：假名读音
- `meaning`：中文释义
- `part_of_speech`：词性
- `jlpt_level`：JLPT等级 (N5/N4/N3/N2/N1)

**可选字段：**
- `example_sentence`：例句

**示例CSV模板：**
```csv
word,reading,meaning,part_of_speech,jlpt_level,example_sentence
こんにちは,konnichiwa,你好,感叹词,N5,"こんにちは、田中さん。"
ありがとう,arigatou,谢谢,感叹词,N5,"ありがとうございます。"
```

### 4. 练习题批量导入
**必填字段：**
- `title`：题目标题
- `type`：练习类型 (vocabulary/grammar/listening/speaking)
- `course_day`：所属课程天数
- `question`：题目内容
- `correct_answer`：正确答案

**可选字段：**
- `options`：选项 (逗号分隔)
- `explanation`：题目解析
- `points`：分数

**示例CSV模板：**
```csv
title,type,course_day,question,options,correct_answer,explanation,points
问候语选择题,vocabulary,1,"\"你好\"用日语怎么说？","A.こんにちは,B.ありがとう,C.すみません,D.さようなら",A,こんにちは是最常用的问候语,10
```

## 🔧 使用方法

### 1. 访问批量导入功能
1. 登录管理后台
2. 进入 "内容管理" 页面
3. 选择对应的内容标签页（课程/材料/词汇/练习题）
4. 点击 "批量导入" 按钮

### 2. 导入流程

#### 步骤1：文件上传
- 拖拽文件到上传区域或点击选择文件
- 支持格式：CSV、Excel、JSON
- 可下载标准模板文件作为参考

#### 步骤2：数据验证
- 系统自动验证文件格式和数据完整性
- 显示验证结果统计：总记录数、有效记录、错误、警告
- 提供详细的错误信息和修复建议

#### 步骤3：数据预览
- 显示前10条记录供确认
- 标明必填字段和可选字段
- 最后确认是否继续导入

#### 步骤4：执行导入
- 显示实时导入进度
- 采用分批处理避免系统过载
- 每批处理10条数据，避免服务器压力

#### 步骤5：查看结果
- 显示导入结果统计
- 详细列出导入错误信息
- 可选择重新导入或完成操作

### 3. 数据验证规则

#### 课程验证
- 天数必须在1-90之间且唯一
- 难度必须是指定值之一
- 标题不能为空且长度不超过255字符

#### 词汇验证
- JLPT等级必须是N5-N1之一
- 词汇、读音、释义为必填项
- 词性需要符合日语语法规范

#### 练习题验证
- 练习类型必须是指定值之一
- 必须关联到已存在的课程
- 选项格式需要正确

## 📊 批量操作功能

### 批量删除
- 选择多个内容项进行批量删除
- 支持最多100条记录同时删除
- 删除前需要确认操作

### 数据导出
- 支持导出CSV格式文件
- 包含完整的数据字段
- 可用作备份或迁移

## 🔄 API接口

### 批量创建
```http
POST /api/admin/content/batch/{contentType}
Content-Type: application/json

{
  "data": [
    {
      "title": "课程标题",
      "description": "课程描述",
      ...
    }
  ]
}
```

### 批量删除
```http
DELETE /api/admin/content/batch/{contentType}
Content-Type: application/json

{
  "ids": [1, 2, 3, 4, 5]
}
```

### 数据导出
```http
GET /api/admin/content/export/{contentType}?format=csv
```

## ⚡ 性能优化

### 前端优化
- **React.memo**：优化组件渲染性能
- **useCallback**：缓存事件处理函数
- **useMemo**：缓存计算结果
- **分批处理**：避免大文件解析卡顿

### 后端优化
- **事务处理**：保证数据一致性
- **分批导入**：每批10条记录，避免内存溢出
- **数据验证**：提前验证避免无效导入
- **错误处理**：详细的错误日志和回滚机制

## 🛡️ 安全措施

### 文件安全
- 文件类型验证
- 文件大小限制（最大100MB）
- 恶意代码检测

### 数据安全
- SQL注入防护
- XSS攻击防护
- 认证和授权验证

### 操作安全
- 操作日志记录
- 权限级别控制
- 数据备份机制

## 📚 最佳实践

### 1. 数据准备
- **使用模板**：下载标准模板确保格式正确
- **数据清洗**：导入前检查数据完整性
- **小批量测试**：先导入少量数据验证格式

### 2. 导入策略
- **分批导入**：大量数据分多次导入
- **错误处理**：及时处理验证错误
- **备份数据**：导入前备份现有数据

### 3. 性能考虑
- **避免高峰期**：选择系统负载较低时导入
- **监控进度**：密切关注导入进度和系统状态
- **及时清理**：导入完成后清理临时文件

## 🔍 故障排除

### 常见问题

#### 1. 文件解析失败
**原因**：文件格式不正确或编码问题
**解决**：确保使用UTF-8编码，检查文件格式

#### 2. 数据验证失败
**原因**：必填字段缺失或数据格式错误
**解决**：根据错误提示修正数据格式

#### 3. 导入进度卡住
**原因**：网络问题或服务器负载过高
**解决**：刷新页面重试，或联系管理员

#### 4. 部分数据导入失败
**原因**：数据重复或关联关系错误
**解决**：检查错误报告，修正问题数据后重新导入

### 错误代码说明
- `422`：数据验证失败
- `400`：请求格式错误
- `500`：服务器内部错误
- `413`：文件过大

## 📈 扩展功能

### 计划中的功能
- **Excel高级支持**：多表格、公式、图表
- **实时同步**：与外部系统实时数据同步
- **定时导入**：设置定时任务自动导入
- **版本管理**：数据版本控制和回滚
- **导入模板编辑器**：在线编辑导入模板

---

## 📞 技术支持

如有问题或建议，请联系开发团队：
- 📧 Email: support@90nihongo.com  
- 🐛 Bug Report: GitHub Issues
- 📖 Documentation: [在线文档](https://docs.90nihongo.com)

---

*最后更新：2024年12月* 